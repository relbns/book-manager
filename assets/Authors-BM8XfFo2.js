import{u as _,F as s,r as l,j as e,T as q,B as o,l as h,f as x,m as z,p as b,e as N}from"./index-CXoMd3eq.js";import{d as w}from"./dayjs.min-ByYfQ7Ci.js";import{R as O}from"./ResponsiveFilterContainer-ylpbmGBo.js";import{R as K,a as W}from"./SearchOutlined-VIEJ2mEe.js";import{S as k}from"./index-D5izTTYS.js";import{M as C,R as G}from"./DeleteOutlined-Cq42ifU7.js";import{D as T}from"./index-BlUl9-Rg.js";import{A as H}from"./index-vL8_-Ao3.js";import{R as J}from"./UserOutlined-D4bH0i3f.js";import{T as S}from"./index-BZT2Nlzq.js";import{R as Q,P as U}from"./EditOutlined-t1y1Qw90.js";import{F as X}from"./Table-C_nVy8R9.js";import"./DeleteOutlined-BnYVCxbz.js";import"./dropdown-yxXLn2-i.js";import"./Pagination-CN7D9New.js";const{Title:Z,Text:ee}=q,{TextArea:Y}=h,{Option:te}=k,re=x(X)`
  .ant-table-thead > tr > th {
    text-align: right;
  }

  .ant-table-cell {
    text-align: right;
  }
`,ae=x(N)`
  margin-bottom: 24px;
`;x.div`
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 24px;
`;const se=x.div`
  display: flex;
  justify-content: flex-end;
  gap: 8px;
`,be=()=>{const{authors:n,addAuthor:A,updateAuthor:I,deleteAuthor:R,books:p,createAuthorModel:F}=_(),[i]=s.useForm(),[c,u]=l.useState(""),[v,m]=l.useState(!1),[d,$]=l.useState(null),[B,f]=l.useState([]),[y,M]=l.useState([]);l.useEffect(()=>{if(!c.trim()){f(n);return}const t=c.toLowerCase(),r=n.filter(a=>a.name.toLowerCase().includes(t)||a.nationality&&a.nationality.toLowerCase().includes(t));f(r)},[n,c]),l.useEffect(()=>{const t=[...new Set(n.map(r=>r.nationality).filter(Boolean))];M(t)},[n]);const E=t=>p.filter(r=>r.author===t).length,j=(t=null)=>{$(t),t?i.setFieldsValue({...t,birthYear:t.birthYear?w(t.birthYear.toString()):null,deathYear:t.deathYear?w(t.deathYear.toString()):null}):i.resetFields(),m(!0)},g=()=>{m(!1),i.resetFields()},V=async t=>{const r={...t,birthYear:t.birthYear?t.birthYear.year():null,deathYear:t.deathYear?t.deathYear.year():null};d?await I(d.id,r):await A(r),m(!1),i.resetFields()},P=async t=>{const r=p.filter(a=>a.author===t).length;if(r>0){C.confirm({title:"לא ניתן למחוק מחבר זה",content:`מחבר זה משויך ל-${r} ספרים. אנא הסר או שנה את השיוך בספרים אלו לפני מחיקת המחבר.`,okText:"הבנתי",cancelText:null,cancelButtonProps:{style:{display:"none"}}});return}await R(t)},D=[{title:"שם המחבר",dataIndex:"name",key:"name",render:(t,r)=>e.jsxs(z,{children:[e.jsx(H,{icon:e.jsx(J,{})}),e.jsx(ee,{strong:!0,children:t})]})},{title:"אזרחות",dataIndex:"nationality",key:"nationality",render:t=>t||"-"},{title:"שנים",key:"years",render:(t,r)=>{const a=r.birthYear||"?",L=r.deathYear||(r.birthYear?"חי":"?");return`${a} - ${L}`}},{title:"ספרים",key:"bookCount",render:(t,r)=>{const a=E(r.id);return a>0?e.jsx(S,{color:"blue",children:a}):e.jsx(S,{color:"default",children:"0"})}},{title:"פעולות",key:"actions",width:120,render:(t,r)=>e.jsxs(se,{children:[e.jsx(b,{title:"עריכה",children:e.jsx(o,{icon:e.jsx(Q,{}),type:"text",onClick:()=>j(r)})}),e.jsx(b,{title:"מחיקה",children:e.jsx(U,{title:"בטוח שאתה רוצה למחוק את המחבר?",onConfirm:()=>P(r.id),okText:"כן",cancelText:"לא",placement:"topRight",children:e.jsx(o,{icon:e.jsx(G,{}),type:"text",danger:!0})})})]})}];return e.jsxs("div",{children:[e.jsxs(ae,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(Z,{level:2,children:"סופרים"}),e.jsx(o,{type:"primary",icon:e.jsx(K,{}),onClick:()=>j(),children:"הוספת סופר"})]}),e.jsxs(O,{children:[e.jsx(h,{placeholder:"חיפוש לפי שם או אזרחות",prefix:e.jsx(W,{}),value:c,onChange:t=>u(t.target.value),style:{width:300}}),y.length>0&&e.jsx(k,{allowClear:!0,style:{minWidth:200},placeholder:"סינון לפי אזרחות",onChange:t=>u(t||""),children:y.map(t=>e.jsx(te,{value:t,children:t},t))})]}),e.jsx(re,{dataSource:B,columns:D,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`סה"כ ${t} סופרים`},locale:{emptyText:"לא נמצאו סופרים"}})]}),e.jsx(C,{title:d?"עריכת סופר":"הוספת סופר חדש",open:v,onCancel:g,footer:null,destroyOnClose:!0,children:e.jsxs(s,{form:i,layout:"vertical",onFinish:V,initialValues:F(),children:[e.jsx(s.Item,{name:"name",label:"שם הסופר",rules:[{required:!0,message:"נא להזין את שם הסופר"}],children:e.jsx(h,{placeholder:"הזן את שם הסופר"})}),e.jsx(s.Item,{name:"nationality",label:"אזרחות",children:e.jsx(h,{placeholder:"הזן את האזרחות של הסופר"})}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(s.Item,{name:"birthYear",label:"שנת לידה",style:{flex:1},children:e.jsx(T,{picker:"year",style:{width:"100%"}})}),e.jsx(s.Item,{name:"deathYear",label:"שנת פטירה",style:{flex:1},children:e.jsx(T,{picker:"year",style:{width:"100%"}})})]}),e.jsx(s.Item,{name:"biography",label:"ביוגרפיה",children:e.jsx(Y,{placeholder:"הזן ביוגרפיה",rows:4})}),e.jsx(s.Item,{name:"notes",label:"הערות",children:e.jsx(Y,{placeholder:"הערות נוספות",rows:3})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:16},children:[e.jsx(o,{onClick:g,children:"ביטול"}),e.jsx(o,{type:"primary",htmlType:"submit",children:d?"עדכון":"הוספה"})]})]})})]})};export{be as default};
//# sourceMappingURL=Authors-BM8XfFo2.js.map
