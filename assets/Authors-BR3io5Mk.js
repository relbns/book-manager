import{u as _,F as s,r as l,j as e,T as q,B as o,k as h,f as x,S as z,l as b,e as N}from"./index-BZbfShRi.js";import{d as w}from"./dayjs.min-DwegfA2E.js";import{R as O,a as K,b as W}from"./ResponsiveFilterContainer-D2Div_md.js";import{S as k}from"./index-CGmZKCwg.js";import{M as C,R as G}from"./DeleteOutlined-DwOr8z1T.js";import{D as S}from"./index-6liAhSc1.js";import{A as H}from"./index-AzyMeTni.js";import{R as J}from"./UserOutlined-BzFmFviT.js";import{T}from"./index-B4W8rN_h.js";import{R as Q,P as U}from"./EditOutlined-D8uqvWcn.js";import{F as X}from"./Table-DM0GOEUw.js";import"./useClosable-gFP0jpH6.js";import"./DeleteOutlined-DZl07uw-.js";import"./dropdown-BlGPvsQt.js";import"./Pagination-B4h8omi_.js";const{Title:Z,Text:ee}=q,{TextArea:Y}=h,{Option:te}=k,ae=x(X)`
  .ant-table-thead > tr > th {
    text-align: right;
  }

  .ant-table-cell {
    text-align: right;
  }
`,re=x(N)`
  margin-bottom: 24px;
`;x.div`
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 24px;
`;const se=x.div`
  display: flex;
  justify-content: flex-end;
  gap: 8px;
`,be=()=>{const{authors:n,addAuthor:A,updateAuthor:I,deleteAuthor:F,books:m,createAuthorModel:R}=_(),[i]=s.useForm(),[c,u]=l.useState(""),[v,p]=l.useState(!1),[d,$]=l.useState(null),[B,f]=l.useState([]),[y,M]=l.useState([]);l.useEffect(()=>{if(!c.trim()){f(n);return}const t=c.toLowerCase(),a=n.filter(r=>r.name.toLowerCase().includes(t)||r.nationality&&r.nationality.toLowerCase().includes(t));f(a)},[n,c]),l.useEffect(()=>{const t=[...new Set(n.map(a=>a.nationality).filter(Boolean))];M(t)},[n]);const E=t=>m.filter(a=>a.author===t).length,j=(t=null)=>{$(t),t?i.setFieldsValue({...t,birthYear:t.birthYear?w(t.birthYear.toString()):null,deathYear:t.deathYear?w(t.deathYear.toString()):null}):i.resetFields(),p(!0)},g=()=>{p(!1),i.resetFields()},V=async t=>{const a={...t,birthYear:t.birthYear?t.birthYear.year():null,deathYear:t.deathYear?t.deathYear.year():null};d?await I(d.id,a):await A(a),p(!1),i.resetFields()},P=async t=>{const a=m.filter(r=>r.author===t).length;if(a>0){C.confirm({title:"לא ניתן למחוק מחבר זה",content:`מחבר זה משויך ל-${a} ספרים. אנא הסר או שנה את השיוך בספרים אלו לפני מחיקת המחבר.`,okText:"הבנתי",cancelText:null,cancelButtonProps:{style:{display:"none"}}});return}await F(t)},D=[{title:"שם המחבר",dataIndex:"name",key:"name",render:(t,a)=>e.jsxs(z,{children:[e.jsx(H,{icon:e.jsx(J,{})}),e.jsx(ee,{strong:!0,children:t})]})},{title:"אזרחות",dataIndex:"nationality",key:"nationality",render:t=>t||"-"},{title:"שנים",key:"years",render:(t,a)=>{const r=a.birthYear||"?",L=a.deathYear||(a.birthYear?"חי":"?");return`${r} - ${L}`}},{title:"ספרים",key:"bookCount",render:(t,a)=>{const r=E(a.id);return r>0?e.jsx(T,{color:"blue",children:r}):e.jsx(T,{color:"default",children:"0"})}},{title:"פעולות",key:"actions",width:120,render:(t,a)=>e.jsxs(se,{children:[e.jsx(b,{title:"עריכה",children:e.jsx(o,{icon:e.jsx(Q,{}),type:"text",onClick:()=>j(a)})}),e.jsx(b,{title:"מחיקה",children:e.jsx(U,{title:"בטוח שאתה רוצה למחוק את המחבר?",onConfirm:()=>P(a.id),okText:"כן",cancelText:"לא",placement:"topRight",children:e.jsx(o,{icon:e.jsx(G,{}),type:"text",danger:!0})})})]})}];return e.jsxs("div",{children:[e.jsxs(re,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(Z,{level:2,children:"סופרים"}),e.jsx(o,{type:"primary",icon:e.jsx(O,{}),onClick:()=>j(),children:"הוספת סופר"})]}),e.jsxs(K,{children:[e.jsx(h,{placeholder:"חיפוש לפי שם או אזרחות",prefix:e.jsx(W,{}),value:c,onChange:t=>u(t.target.value),style:{width:300}}),y.length>0&&e.jsx(k,{allowClear:!0,style:{minWidth:200},placeholder:"סינון לפי אזרחות",onChange:t=>u(t||""),children:y.map(t=>e.jsx(te,{value:t,children:t},t))})]}),e.jsx(ae,{dataSource:B,columns:D,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`סה"כ ${t} סופרים`},locale:{emptyText:"לא נמצאו סופרים"}})]}),e.jsx(C,{title:d?"עריכת סופר":"הוספת סופר חדש",open:v,onCancel:g,footer:null,destroyOnClose:!0,children:e.jsxs(s,{form:i,layout:"vertical",onFinish:V,initialValues:R(),children:[e.jsx(s.Item,{name:"name",label:"שם הסופר",rules:[{required:!0,message:"נא להזין את שם הסופר"}],children:e.jsx(h,{placeholder:"הזן את שם הסופר"})}),e.jsx(s.Item,{name:"nationality",label:"אזרחות",children:e.jsx(h,{placeholder:"הזן את האזרחות של הסופר"})}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(s.Item,{name:"birthYear",label:"שנת לידה",style:{flex:1},children:e.jsx(S,{picker:"year",style:{width:"100%"}})}),e.jsx(s.Item,{name:"deathYear",label:"שנת פטירה",style:{flex:1},children:e.jsx(S,{picker:"year",style:{width:"100%"}})})]}),e.jsx(s.Item,{name:"biography",label:"ביוגרפיה",children:e.jsx(Y,{placeholder:"הזן ביוגרפיה",rows:4})}),e.jsx(s.Item,{name:"notes",label:"הערות",children:e.jsx(Y,{placeholder:"הערות נוספות",rows:3})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:16},children:[e.jsx(o,{onClick:g,children:"ביטול"}),e.jsx(o,{type:"primary",htmlType:"submit",children:d?"עדכון":"הוספה"})]})]})})]})};export{be as default};
//# sourceMappingURL=Authors-BR3io5Mk.js.map
