import{r as m,I as G,u as J,F as l,j as e,T as K,m as R,e as I,B as y,A as O,f as S,l as C}from"./index-CXoMd3eq.js";import{D as q,R as H,c as Q}from"./csvService-DgcN5-Mj.js";import{d as E}from"./dayjs.min-ByYfQ7Ci.js";import{S as w}from"./index-D5izTTYS.js";import{R as U}from"./FilterOutlined-BnTOFMnl.js";import{C as W,F as X}from"./Table-C_nVy8R9.js";import{R as Z}from"./WarningOutlined-DyUFb7y5.js";import{D as ee}from"./index-BlUl9-Rg.js";import{s as b}from"./index-BW31C8rb.js";import"./dropdown-yxXLn2-i.js";import"./Pagination-CN7D9New.js";function v(){return v=Object.assign?Object.assign.bind():function(p){for(var o=1;o<arguments.length;o++){var x=arguments[o];for(var u in x)Object.prototype.hasOwnProperty.call(x,u)&&(p[u]=x[u])}return p},v.apply(this,arguments)}const te=(p,o)=>m.createElement(G,v({},p,{ref:o,icon:q})),se=m.forwardRef(te),{Title:re,Text:A,Paragraph:ne}=K,{Option:i}=w,{RangePicker:ae}=ee,le=S(I)`
  margin-bottom: 24px;
`,ie=S.div`
  max-width: 800px;
  margin: 0 auto;
`,oe=S(X)`
  .ant-table-thead > tr > th {
    text-align: right;
  }

  .ant-table-cell {
    text-align: right;
  }
`,be=()=>{const{books:p,loans:o,categories:x,authors:u,publishers:k}=J(),[c,$]=m.useState("books"),[j,B]=m.useState([]),[a,F]=m.useState([]),[d,D]=m.useState([]),[T]=l.useForm(),[f,Y]=m.useState(!1);m.useEffect(()=>{let t=[],s=[];switch(c){case"books":t=[...p],s=["id","title","author","publisher","isbn","publicationYear","language","categories"];break;case"authors":t=[...u],s=["id","name","biography","birthYear","nationality"];break;case"categories":t=[...x],s=["id","name","description","color","parent"];break;case"publishers":t=[...k],s=["id","name","location","website"];break;case"loans":t=[...o],s=["id","bookId","borrowerName","borrowerContact","loanDate","dueDate","returnDate","status"];break;default:t=[],s=[]}B(t),F(t),D(s),T.resetFields()},[c,p,u,x,k,o]);const P=()=>{if(!a.length){b.error("אין נתונים לייצוא");return}try{let t=a;d.length>0&&d.length<Object.keys(a[0]||{}).length&&(t=a.map(n=>{const g={};return d.forEach(h=>{g[h]=n[h]}),g}));const s=E().format("YYYY-MM-DD"),r=`${c}_${s}.csv`;Q.exportToCSV(t,r),b.success(`יוצאו ${t.length} רשומות בהצלחה`)}catch(t){b.error(`שגיאה בייצוא: ${t.message}`)}},L=t=>{let s=[...j];if(t.searchText){const r=t.searchText.toLowerCase();s=s.filter(n=>Object.entries(n).some(([g,h])=>typeof h=="string"&&h.toLowerCase().includes(r)))}if(c==="loans"&&t.dateRange&&t.dateRange.length===2){const r=t.dateRange[0].startOf("day"),n=t.dateRange[1].endOf("day");s=s.filter(g=>{const h=E(g.loanDate);return h.isAfter(r)&&h.isBefore(n)})}c==="loans"&&t.status&&t.status.length>0&&(s=s.filter(r=>t.status.includes(r.status))),c==="books"&&t.categories&&t.categories.length>0&&(s=s.filter(r=>r.categories?r.categories.some(n=>t.categories.includes(n)):!1)),F(s),b.info(`נמצאו ${s.length} רשומות`)},M=()=>{T.resetFields(),F(j)},N=t=>{D(t)},z=()=>j.length?Object.keys(j[0]).map(t=>({label:t,value:t})):[],V=()=>{if(!a.length)return[];const t=Object.keys(a[0]);return(d.length>0?d.filter(r=>t.includes(r)):t).map(r=>({title:r,dataIndex:r,key:r,render:n=>n==null?"-":Array.isArray(n)?n.join(", "):typeof n=="object"?JSON.stringify(n):String(n)}))},_=()=>{switch(c){case"books":return e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(C,{placeholder:"חיפוש לפי שם, מחבר או מק״ט"})}),e.jsx(l.Item,{name:"categories",label:"קטגוריות",children:e.jsx(w,{mode:"multiple",placeholder:"בחר קטגוריות",allowClear:!0,children:x.map(t=>e.jsx(i,{value:t.id,children:t.name},t.id))})})]});case"loans":return e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(C,{placeholder:"חיפוש לפי שם השואל"})}),e.jsx(l.Item,{name:"dateRange",label:"טווח תאריכים",children:e.jsx(ae,{style:{width:"100%"}})}),e.jsx(l.Item,{name:"status",label:"סטטוס השאלה",children:e.jsxs(w,{mode:"multiple",placeholder:"בחר סטטוס",allowClear:!0,children:[e.jsx(i,{value:"active",children:"פעיל"}),e.jsx(i,{value:"returned",children:"הוחזר"}),e.jsx(i,{value:"overdue",children:"באיחור"})]})})]});default:return e.jsx(l.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(C,{placeholder:"חיפוש בכל השדות"})})}};return e.jsx(ie,{children:e.jsxs(le,{children:[e.jsx(re,{level:2,children:"ייצוא נתונים"}),e.jsxs(R,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(w,{value:c,onChange:$,style:{width:"100%",marginBottom:16},children:[e.jsx(i,{value:"books",children:"ספרים"}),e.jsx(i,{value:"authors",children:"סופרים"}),e.jsx(i,{value:"categories",children:"קטגוריות"}),e.jsx(i,{value:"publishers",children:"הוצאות לאור"}),e.jsx(i,{value:"loans",children:"השאלות"})]}),e.jsxs(I,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(U,{style:{marginLeft:8}}),e.jsx("span",{children:"סינון נתונים"})]}),type:"inner",extra:e.jsx(y,{type:"link",onClick:()=>Y(!f),children:f?"הסתר":"הצג"}),style:{marginBottom:16},children:[f&&e.jsxs(l,{form:T,layout:"vertical",onFinish:L,children:[_(),e.jsx(l.Item,{children:e.jsxs(R,{children:[e.jsx(y,{type:"primary",htmlType:"submit",children:"החל סינון"}),e.jsx(y,{onClick:M,children:"איפוס"})]})})]}),!f&&e.jsx(A,{type:"secondary",children:"לחץ על 'הצג' כדי להגדיר סינונים לנתונים לפני הייצוא"})]}),e.jsxs(I,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(H,{style:{marginLeft:8}}),e.jsx("span",{children:"שדות לייצוא"})]}),type:"inner",style:{marginBottom:16},children:[e.jsx(W.Group,{options:z(),value:d,onChange:N}),d.length===0&&e.jsx(O,{message:"אנא בחר לפחות שדה אחד לייצוא",type:"warning",showIcon:!0,icon:e.jsx(Z,{}),style:{marginTop:16}})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ne,{children:[a.length," רשומות נמצאו לייצוא"]})}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{dataSource:a.slice(0,5),columns:V(),pagination:!1,size:"small",scroll:{x:"max-content"},rowKey:"id"}),a.length>5&&e.jsx("div",{style:{textAlign:"center",padding:"8px 0"},children:e.jsxs(A,{type:"secondary",children:["מוצגות 5 רשומות ראשונות מתוך ",a.length]})})]}),e.jsx("div",{style:{marginTop:16,display:"flex",justifyContent:"center"},children:e.jsx(y,{type:"primary",icon:e.jsx(se,{}),onClick:P,disabled:a.length===0||d.length===0,size:"large",children:"ייצא ל-CSV"})}),a.length===0&&e.jsx(O,{message:"אין נתונים לייצוא",description:"אנא נסה לשנות את הסינון או לבחור סוג נתונים אחר.",type:"info",showIcon:!0,style:{marginTop:16}})]})]})})};export{be as default};
//# sourceMappingURL=Export-DDyiP-5c.js.map
