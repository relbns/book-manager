import{u as _,F as s,r as l,j as e,T as q,B as o,t as h,f as x,v as z,w as b,e as N}from"./index-BcB6TR_P.js";import{d as w}from"./dayjs.min-cdk7TPaz.js";import{R as O,a as K}from"./SearchOutlined-4AFhEHmm.js";import{S as k}from"./index-BM1-CXB8.js";import{M as C,R as W}from"./DeleteOutlined-45iXn-ij.js";import{D as T}from"./index-CSumOrvl.js";import{A as G}from"./index-8dHTDZMR.js";import{R as H}from"./UserOutlined-CXP9m3gv.js";import{T as S}from"./index-DelqRfdy.js";import{R as J,P as Q}from"./EditOutlined-BXMsr0xT.js";import{F as U}from"./Table-B3hNfghm.js";import"./useClosable-Bjz1Rjzt.js";import"./DeleteOutlined-TdVZvq32.js";import"./dropdown-WlPtj15S.js";import"./Pagination-C5EEw3uv.js";const{Title:X,Text:Z}=q,{TextArea:Y}=h,{Option:ee}=k,te=x(U)`
  .ant-table-thead > tr > th {
    text-align: right;
  }

  .ant-table-cell {
    text-align: right;
  }
`,re=x(N)`
  margin-bottom: 24px;
`,ae=x.div`
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  margin-bottom: 24px;
`,se=x.div`
  display: flex;
  justify-content: flex-end;
  gap: 8px;
`,be=()=>{const{authors:n,addAuthor:A,updateAuthor:I,deleteAuthor:F,books:p,createAuthorModel:R}=_(),[i]=s.useForm(),[c,u]=l.useState(""),[v,m]=l.useState(!1),[d,$]=l.useState(null),[B,f]=l.useState([]),[y,M]=l.useState([]);l.useEffect(()=>{if(!c.trim()){f(n);return}const t=c.toLowerCase(),r=n.filter(a=>a.name.toLowerCase().includes(t)||a.nationality&&a.nationality.toLowerCase().includes(t));f(r)},[n,c]),l.useEffect(()=>{const t=[...new Set(n.map(r=>r.nationality).filter(Boolean))];M(t)},[n]);const E=t=>p.filter(r=>r.author===t).length,j=(t=null)=>{$(t),t?i.setFieldsValue({...t,birthYear:t.birthYear?w(t.birthYear.toString()):null,deathYear:t.deathYear?w(t.deathYear.toString()):null}):i.resetFields(),m(!0)},g=()=>{m(!1),i.resetFields()},V=async t=>{const r={...t,birthYear:t.birthYear?t.birthYear.year():null,deathYear:t.deathYear?t.deathYear.year():null};d?await I(d.id,r):await A(r),m(!1),i.resetFields()},P=async t=>{const r=p.filter(a=>a.author===t).length;if(r>0){C.confirm({title:"לא ניתן למחוק מחבר זה",content:`מחבר זה משויך ל-${r} ספרים. אנא הסר או שנה את השיוך בספרים אלו לפני מחיקת המחבר.`,okText:"הבנתי",cancelText:null,cancelButtonProps:{style:{display:"none"}}});return}await F(t)},D=[{title:"שם המחבר",dataIndex:"name",key:"name",render:(t,r)=>e.jsxs(z,{children:[e.jsx(G,{icon:e.jsx(H,{})}),e.jsx(Z,{strong:!0,children:t})]})},{title:"אזרחות",dataIndex:"nationality",key:"nationality",render:t=>t||"-"},{title:"שנים",key:"years",render:(t,r)=>{const a=r.birthYear||"?",L=r.deathYear||(r.birthYear?"חי":"?");return`${a} - ${L}`}},{title:"ספרים",key:"bookCount",render:(t,r)=>{const a=E(r.id);return a>0?e.jsx(S,{color:"blue",children:a}):e.jsx(S,{color:"default",children:"0"})}},{title:"פעולות",key:"actions",width:120,render:(t,r)=>e.jsxs(se,{children:[e.jsx(b,{title:"עריכה",children:e.jsx(o,{icon:e.jsx(J,{}),type:"text",onClick:()=>j(r)})}),e.jsx(b,{title:"מחיקה",children:e.jsx(Q,{title:"בטוח שאתה רוצה למחוק את המחבר?",onConfirm:()=>P(r.id),okText:"כן",cancelText:"לא",placement:"topRight",children:e.jsx(o,{icon:e.jsx(W,{}),type:"text",danger:!0})})})]})}];return e.jsxs("div",{children:[e.jsxs(re,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx(X,{level:2,children:"סופרים"}),e.jsx(o,{type:"primary",icon:e.jsx(O,{}),onClick:()=>j(),children:"הוספת סופר"})]}),e.jsxs(ae,{children:[e.jsx(h,{placeholder:"חיפוש לפי שם או אזרחות",prefix:e.jsx(K,{}),value:c,onChange:t=>u(t.target.value),style:{width:300}}),y.length>0&&e.jsx(k,{allowClear:!0,style:{minWidth:200},placeholder:"סינון לפי אזרחות",onChange:t=>u(t||""),children:y.map(t=>e.jsx(ee,{value:t,children:t},t))})]}),e.jsx(te,{dataSource:B,columns:D,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showTotal:t=>`סה"כ ${t} סופרים`},locale:{emptyText:"לא נמצאו סופרים"}})]}),e.jsx(C,{title:d?"עריכת סופר":"הוספת סופר חדש",open:v,onCancel:g,footer:null,destroyOnClose:!0,children:e.jsxs(s,{form:i,layout:"vertical",onFinish:V,initialValues:R(),children:[e.jsx(s.Item,{name:"name",label:"שם הסופר",rules:[{required:!0,message:"נא להזין את שם הסופר"}],children:e.jsx(h,{placeholder:"הזן את שם הסופר"})}),e.jsx(s.Item,{name:"nationality",label:"אזרחות",children:e.jsx(h,{placeholder:"הזן את האזרחות של הסופר"})}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(s.Item,{name:"birthYear",label:"שנת לידה",style:{flex:1},children:e.jsx(T,{picker:"year",style:{width:"100%"}})}),e.jsx(s.Item,{name:"deathYear",label:"שנת פטירה",style:{flex:1},children:e.jsx(T,{picker:"year",style:{width:"100%"}})})]}),e.jsx(s.Item,{name:"biography",label:"ביוגרפיה",children:e.jsx(Y,{placeholder:"הזן ביוגרפיה",rows:4})}),e.jsx(s.Item,{name:"notes",label:"הערות",children:e.jsx(Y,{placeholder:"הערות נוספות",rows:3})}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:16},children:[e.jsx(o,{onClick:g,children:"ביטול"}),e.jsx(o,{type:"primary",htmlType:"submit",children:d?"עדכון":"הוספה"})]})]})})]})};export{be as default};
//# sourceMappingURL=Authors-DZLDDXgG.js.map
