{"version":3,"file":"Authors-BM8XfFo2.js","sources":["../../src/pages/Authors.jsx"],"sourcesContent":["// src/pages/Authors.jsx\nimport React, { useState, useEffect } from 'react';\nimport {\n  Table,\n  Button,\n  Input,\n  Card,\n  Space,\n  Modal,\n  Form,\n  Select,\n  DatePicker,\n  Typography,\n  Tag,\n  Tooltip,\n  Popconfirm,\n  Avatar,\n} from 'antd';\nimport {\n  SearchOutlined,\n  PlusOutlined,\n  EditOutlined,\n  DeleteOutlined,\n  UserOutlined,\n} from '@ant-design/icons';\nimport styled from 'styled-components';\nimport { useAppContext } from '../context/AppContext';\nimport dayjs from 'dayjs';\nimport ResponsiveFilterContainer from '../components/common/ResponsiveFilterContainer';\n\nconst { Title, Text } = Typography;\nconst { TextArea } = Input;\nconst { Option } = Select;\n\n// Style for RTL tables\nconst StyledTable = styled(Table)`\n  .ant-table-thead > tr > th {\n    text-align: right;\n  }\n\n  .ant-table-cell {\n    text-align: right;\n  }\n`;\n\nconst StyledCard = styled(Card)`\n  margin-bottom: 24px;\n`;\n\nconst FilterContainer = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  gap: 16px;\n  margin-bottom: 24px;\n`;\n\nconst ActionsColumn = styled.div`\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n`;\n\nconst Authors = () => {\n  const {\n    authors,\n    addAuthor,\n    updateAuthor,\n    deleteAuthor,\n    books,\n    createAuthorModel,\n  } = useAppContext();\n\n  // State\n  const [form] = Form.useForm();\n  const [searchText, setSearchText] = useState('');\n  const [isModalVisible, setIsModalVisible] = useState(false);\n  const [editingAuthor, setEditingAuthor] = useState(null);\n  const [filteredAuthors, setFilteredAuthors] = useState([]);\n  const [nationalities, setNationalities] = useState([]);\n\n  // Filter authors based on search text\n  useEffect(() => {\n    if (!searchText.trim()) {\n      setFilteredAuthors(authors);\n      return;\n    }\n\n    const lowerSearchText = searchText.toLowerCase();\n    const filtered = authors.filter(\n      (author) =>\n        author.name.toLowerCase().includes(lowerSearchText) ||\n        (author.nationality &&\n          author.nationality.toLowerCase().includes(lowerSearchText))\n    );\n\n    setFilteredAuthors(filtered);\n  }, [authors, searchText]);\n\n  // Extract unique nationalities for filtering\n  useEffect(() => {\n    const uniqueNationalities = [\n      ...new Set(authors.map((author) => author.nationality).filter(Boolean)),\n    ];\n    setNationalities(uniqueNationalities);\n  }, [authors]);\n\n  // Get book count for an author\n  const getAuthorBookCount = (authorId) => {\n    return books.filter((book) => book.author === authorId).length;\n  };\n\n  // Modal handlers\n  const showModal = (author = null) => {\n    setEditingAuthor(author);\n\n    if (author) {\n      form.setFieldsValue({\n        ...author,\n        birthYear: author.birthYear ? dayjs(author.birthYear.toString()) : null,\n        deathYear: author.deathYear ? dayjs(author.deathYear.toString()) : null,\n      });\n    } else {\n      form.resetFields();\n    }\n\n    setIsModalVisible(true);\n  };\n\n  const handleCancel = () => {\n    setIsModalVisible(false);\n    form.resetFields();\n  };\n\n  const handleSubmit = async (values) => {\n    // Format dates\n    const formattedValues = {\n      ...values,\n      birthYear: values.birthYear ? values.birthYear.year() : null,\n      deathYear: values.deathYear ? values.deathYear.year() : null,\n    };\n\n    if (editingAuthor) {\n      await updateAuthor(editingAuthor.id, formattedValues);\n    } else {\n      await addAuthor(formattedValues);\n    }\n\n    setIsModalVisible(false);\n    form.resetFields();\n  };\n\n  const handleDelete = async (authorId) => {\n    // Check if author has books\n    const authorBooks = books.filter((book) => book.author === authorId).length;\n\n    if (authorBooks > 0) {\n      Modal.confirm({\n        title: 'לא ניתן למחוק מחבר זה',\n        content: `מחבר זה משויך ל-${authorBooks} ספרים. אנא הסר או שנה את השיוך בספרים אלו לפני מחיקת המחבר.`,\n        okText: 'הבנתי',\n        cancelText: null,\n        cancelButtonProps: { style: { display: 'none' } },\n      });\n      return;\n    }\n\n    await deleteAuthor(authorId);\n  };\n\n  // Table columns\n  const columns = [\n    {\n      title: 'שם המחבר',\n      dataIndex: 'name',\n      key: 'name',\n      render: (text, record) => (\n        <Space>\n          <Avatar icon={<UserOutlined />} />\n          <Text strong>{text}</Text>\n        </Space>\n      ),\n    },\n    {\n      title: 'אזרחות',\n      dataIndex: 'nationality',\n      key: 'nationality',\n      render: (nationality) => nationality || '-',\n    },\n    {\n      title: 'שנים',\n      key: 'years',\n      render: (_, record) => {\n        const birthYear = record.birthYear || '?';\n        const deathYear = record.deathYear || (record.birthYear ? 'חי' : '?');\n        return `${birthYear} - ${deathYear}`;\n      },\n    },\n    {\n      title: 'ספרים',\n      key: 'bookCount',\n      render: (_, record) => {\n        const count = getAuthorBookCount(record.id);\n        return count > 0 ? (\n          <Tag color=\"blue\">{count}</Tag>\n        ) : (\n          <Tag color=\"default\">0</Tag>\n        );\n      },\n    },\n    {\n      title: 'פעולות',\n      key: 'actions',\n      width: 120,\n      render: (_, record) => (\n        <ActionsColumn>\n          <Tooltip title=\"עריכה\">\n            <Button\n              icon={<EditOutlined />}\n              type=\"text\"\n              onClick={() => showModal(record)}\n            />\n          </Tooltip>\n          <Tooltip title=\"מחיקה\">\n            <Popconfirm\n              title=\"בטוח שאתה רוצה למחוק את המחבר?\"\n              onConfirm={() => handleDelete(record.id)}\n              okText=\"כן\"\n              cancelText=\"לא\"\n              placement=\"topRight\"\n            >\n              <Button icon={<DeleteOutlined />} type=\"text\" danger />\n            </Popconfirm>\n          </Tooltip>\n        </ActionsColumn>\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <StyledCard>\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            marginBottom: 16,\n          }}\n        >\n          <Title level={2}>סופרים</Title>\n          <Button\n            type=\"primary\"\n            icon={<PlusOutlined />}\n            onClick={() => showModal()}\n          >\n            הוספת סופר\n          </Button>\n        </div>\n\n        <ResponsiveFilterContainer>\n          <Input\n            placeholder=\"חיפוש לפי שם או אזרחות\"\n            prefix={<SearchOutlined />}\n            value={searchText}\n            onChange={(e) => setSearchText(e.target.value)}\n            style={{ width: 300 }}\n          />\n\n          {nationalities.length > 0 && (\n            <Select\n              allowClear\n              style={{ minWidth: 200 }}\n              placeholder=\"סינון לפי אזרחות\"\n              onChange={(value) => setSearchText(value || '')}\n            >\n              {nationalities.map((nationality) => (\n                <Option key={nationality} value={nationality}>\n                  {nationality}\n                </Option>\n              ))}\n            </Select>\n          )}\n        </ResponsiveFilterContainer>\n\n        <StyledTable\n          dataSource={filteredAuthors}\n          columns={columns}\n          rowKey=\"id\"\n          pagination={{\n            pageSize: 10,\n            showSizeChanger: true,\n            showTotal: (total) => `סה\"כ ${total} סופרים`,\n          }}\n          locale={{\n            emptyText: 'לא נמצאו סופרים',\n          }}\n        />\n      </StyledCard>\n\n      {/* Author Form Modal */}\n      <Modal\n        title={editingAuthor ? 'עריכת סופר' : 'הוספת סופר חדש'}\n        open={isModalVisible}\n        onCancel={handleCancel}\n        footer={null}\n        destroyOnClose\n      >\n        <Form\n          form={form}\n          layout=\"vertical\"\n          onFinish={handleSubmit}\n          initialValues={createAuthorModel()}\n        >\n          <Form.Item\n            name=\"name\"\n            label=\"שם הסופר\"\n            rules={[{ required: true, message: 'נא להזין את שם הסופר' }]}\n          >\n            <Input placeholder=\"הזן את שם הסופר\" />\n          </Form.Item>\n\n          <Form.Item name=\"nationality\" label=\"אזרחות\">\n            <Input placeholder=\"הזן את האזרחות של הסופר\" />\n          </Form.Item>\n\n          <div style={{ display: 'flex', gap: 16 }}>\n            <Form.Item name=\"birthYear\" label=\"שנת לידה\" style={{ flex: 1 }}>\n              <DatePicker picker=\"year\" style={{ width: '100%' }} />\n            </Form.Item>\n\n            <Form.Item name=\"deathYear\" label=\"שנת פטירה\" style={{ flex: 1 }}>\n              <DatePicker picker=\"year\" style={{ width: '100%' }} />\n            </Form.Item>\n          </div>\n\n          <Form.Item name=\"biography\" label=\"ביוגרפיה\">\n            <TextArea placeholder=\"הזן ביוגרפיה\" rows={4} />\n          </Form.Item>\n\n          <Form.Item name=\"notes\" label=\"הערות\">\n            <TextArea placeholder=\"הערות נוספות\" rows={3} />\n          </Form.Item>\n\n          {/* Footer */}\n          <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 16 }}>\n            <Button onClick={handleCancel}>ביטול</Button>\n            <Button type=\"primary\" htmlType=\"submit\">\n              {editingAuthor ? 'עדכון' : 'הוספה'}\n            </Button>\n          </div>\n        </Form>\n      </Modal>\n    </div>\n  );\n};\n\nexport default Authors;\n"],"names":["Title","Text","Typography","TextArea","Input","Option","Select","StyledTable","styled","Table","StyledCard","Card","ActionsColumn","Authors","authors","addAuthor","updateAuthor","deleteAuthor","books","createAuthorModel","useAppContext","form","Form","searchText","setSearchText","useState","isModalVisible","setIsModalVisible","editingAuthor","setEditingAuthor","filteredAuthors","setFilteredAuthors","nationalities","setNationalities","useEffect","lowerSearchText","filtered","author","uniqueNationalities","getAuthorBookCount","authorId","book","showModal","dayjs","handleCancel","handleSubmit","values","formattedValues","handleDelete","authorBooks","Modal","columns","text","record","Space","jsx","Avatar","UserOutlined","nationality","_","birthYear","deathYear","count","Tag","Tooltip","Button","EditOutlined","Popconfirm","DeleteOutlined","jsxs","PlusOutlined","ResponsiveFilterContainer","SearchOutlined","e","value","total","DatePicker"],"mappings":"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"}