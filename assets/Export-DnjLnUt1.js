import{r as d,I as B,u as J,F as h,j as e,T as K,S as R,e as C,B as y,A as E,f as O,k as T}from"./index-BZbfShRi.js";import{D as q,R as Q,c as U}from"./csvService-CG9YVBq9.js";import{d as $}from"./dayjs.min-DwegfA2E.js";import{S as w}from"./index-CGmZKCwg.js";import{C as W,F as X}from"./Table-DM0GOEUw.js";import{R as Z}from"./WarningOutlined-ay4n_I7C.js";import{D as ee}from"./index-6liAhSc1.js";import{s as b}from"./index-BFYnWxa_.js";import"./dropdown-BlGPvsQt.js";import"./Pagination-B4h8omi_.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};function I(){return I=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(i[c]=o[c])}return i},I.apply(this,arguments)}const se=(i,a)=>d.createElement(B,I({},i,{ref:a,icon:q})),re=d.forwardRef(se);function S(){return S=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(i[c]=o[c])}return i},S.apply(this,arguments)}const ne=(i,a)=>d.createElement(B,S({},i,{ref:a,icon:te})),ae=d.forwardRef(ne),{Title:le,Text:A,Paragraph:ie}=K,{Option:m}=w,{RangePicker:oe}=ee,ce=O(C)`
  margin-bottom: 24px;
`,de=O.div`
  max-width: 800px;
  margin: 0 auto;
`,he=O(X)`
  .ant-table-thead > tr > th {
    text-align: right;
  }

  .ant-table-cell {
    text-align: right;
  }
`,ve=()=>{const{books:i,loans:a,categories:o,authors:c,publishers:D}=J(),[p,L]=d.useState("books"),[f,P]=d.useState([]),[l,v]=d.useState([]),[u,k]=d.useState([]),[F]=h.useForm(),[j,Y]=d.useState(!1);d.useEffect(()=>{let t=[],s=[];switch(p){case"books":t=[...i],s=["id","title","author","publisher","isbn","publicationYear","language","categories"];break;case"authors":t=[...c],s=["id","name","biography","birthYear","nationality"];break;case"categories":t=[...o],s=["id","name","description","color","parent"];break;case"publishers":t=[...D],s=["id","name","location","website"];break;case"loans":t=[...a],s=["id","bookId","borrowerName","borrowerContact","loanDate","dueDate","returnDate","status"];break;default:t=[],s=[]}P(t),v(t),k(s),F.resetFields()},[p,i,c,o,D,a]);const z=()=>{if(!l.length){b.error("אין נתונים לייצוא");return}try{let t=l;u.length>0&&u.length<Object.keys(l[0]||{}).length&&(t=l.map(n=>{const g={};return u.forEach(x=>{g[x]=n[x]}),g}));const s=$().format("YYYY-MM-DD"),r=`${p}_${s}.csv`;U.exportToCSV(t,r),b.success(`יוצאו ${t.length} רשומות בהצלחה`)}catch(t){b.error(`שגיאה בייצוא: ${t.message}`)}},M=t=>{let s=[...f];if(t.searchText){const r=t.searchText.toLowerCase();s=s.filter(n=>Object.entries(n).some(([g,x])=>typeof x=="string"&&x.toLowerCase().includes(r)))}if(p==="loans"&&t.dateRange&&t.dateRange.length===2){const r=t.dateRange[0].startOf("day"),n=t.dateRange[1].endOf("day");s=s.filter(g=>{const x=$(g.loanDate);return x.isAfter(r)&&x.isBefore(n)})}p==="loans"&&t.status&&t.status.length>0&&(s=s.filter(r=>t.status.includes(r.status))),p==="books"&&t.categories&&t.categories.length>0&&(s=s.filter(r=>r.categories?r.categories.some(n=>t.categories.includes(n)):!1)),v(s),b.info(`נמצאו ${s.length} רשומות`)},V=()=>{F.resetFields(),v(f)},N=t=>{k(t)},_=()=>f.length?Object.keys(f[0]).map(t=>({label:t,value:t})):[],H=()=>{if(!l.length)return[];const t=Object.keys(l[0]);return(u.length>0?u.filter(r=>t.includes(r)):t).map(r=>({title:r,dataIndex:r,key:r,render:n=>n==null?"-":Array.isArray(n)?n.join(", "):typeof n=="object"?JSON.stringify(n):String(n)}))},G=()=>{switch(p){case"books":return e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(T,{placeholder:"חיפוש לפי שם, מחבר או מק״ט"})}),e.jsx(h.Item,{name:"categories",label:"קטגוריות",children:e.jsx(w,{mode:"multiple",placeholder:"בחר קטגוריות",allowClear:!0,children:o.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))})})]});case"loans":return e.jsxs(e.Fragment,{children:[e.jsx(h.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(T,{placeholder:"חיפוש לפי שם השואל"})}),e.jsx(h.Item,{name:"dateRange",label:"טווח תאריכים",children:e.jsx(oe,{style:{width:"100%"}})}),e.jsx(h.Item,{name:"status",label:"סטטוס השאלה",children:e.jsxs(w,{mode:"multiple",placeholder:"בחר סטטוס",allowClear:!0,children:[e.jsx(m,{value:"active",children:"פעיל"}),e.jsx(m,{value:"returned",children:"הוחזר"}),e.jsx(m,{value:"overdue",children:"באיחור"})]})})]});default:return e.jsx(h.Item,{name:"searchText",label:"חיפוש טקסט",children:e.jsx(T,{placeholder:"חיפוש בכל השדות"})})}};return e.jsx(de,{children:e.jsxs(ce,{children:[e.jsx(le,{level:2,children:"ייצוא נתונים"}),e.jsxs(R,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(w,{value:p,onChange:L,style:{width:"100%",marginBottom:16},children:[e.jsx(m,{value:"books",children:"ספרים"}),e.jsx(m,{value:"authors",children:"סופרים"}),e.jsx(m,{value:"categories",children:"קטגוריות"}),e.jsx(m,{value:"publishers",children:"הוצאות לאור"}),e.jsx(m,{value:"loans",children:"השאלות"})]}),e.jsxs(C,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ae,{style:{marginLeft:8}}),e.jsx("span",{children:"סינון נתונים"})]}),type:"inner",extra:e.jsx(y,{type:"link",onClick:()=>Y(!j),children:j?"הסתר":"הצג"}),style:{marginBottom:16},children:[j&&e.jsxs(h,{form:F,layout:"vertical",onFinish:M,children:[G(),e.jsx(h.Item,{children:e.jsxs(R,{children:[e.jsx(y,{type:"primary",htmlType:"submit",children:"החל סינון"}),e.jsx(y,{onClick:V,children:"איפוס"})]})})]}),!j&&e.jsx(A,{type:"secondary",children:"לחץ על 'הצג' כדי להגדיר סינונים לנתונים לפני הייצוא"})]}),e.jsxs(C,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(Q,{style:{marginLeft:8}}),e.jsx("span",{children:"שדות לייצוא"})]}),type:"inner",style:{marginBottom:16},children:[e.jsx(W.Group,{options:_(),value:u,onChange:N}),u.length===0&&e.jsx(E,{message:"אנא בחר לפחות שדה אחד לייצוא",type:"warning",showIcon:!0,icon:e.jsx(Z,{}),style:{marginTop:16}})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ie,{children:[l.length," רשומות נמצאו לייצוא"]})}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(he,{dataSource:l.slice(0,5),columns:H(),pagination:!1,size:"small",scroll:{x:"max-content"},rowKey:"id"}),l.length>5&&e.jsx("div",{style:{textAlign:"center",padding:"8px 0"},children:e.jsxs(A,{type:"secondary",children:["מוצגות 5 רשומות ראשונות מתוך ",l.length]})})]}),e.jsx("div",{style:{marginTop:16,display:"flex",justifyContent:"center"},children:e.jsx(y,{type:"primary",icon:e.jsx(re,{}),onClick:z,disabled:l.length===0||u.length===0,size:"large",children:"ייצא ל-CSV"})}),l.length===0&&e.jsx(E,{message:"אין נתונים לייצוא",description:"אנא נסה לשנות את הסינון או לבחור סוג נתונים אחר.",type:"info",showIcon:!0,style:{marginTop:16}})]})]})})};export{ve as default};
//# sourceMappingURL=Export-DnjLnUt1.js.map
